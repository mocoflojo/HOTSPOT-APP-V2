{
    "expira_en_1dia": {
        "nombre_visible": "Expira en 1 Hora",
        "script_on_login": "##  SCRIPT FINAL: ELIMINACION DE TICKET (A PRUEBA DE MEDIANOCHE)\r\n:local usuario \"$user\"\r\n:local duracion \"01:00:00\"\r\n\r\n## 1. LIMPIEZA TOTAL\r\n## Primero borramos si ya existe algo con ese nombre para evitar duplicados o errores.\r\n:do {\r\n    /system scheduler remove [find name=\"$usuario\"]\r\n} on-error={}\r\n\r\n## 2. CALCULO DE TIEMPO\r\n:local horaActual [/system clock get time]\r\n:local fechaActual [/system clock get date]\r\n:local horaFin ($horaActual + [:totime $duracion])\r\n\r\n## 3. DEFINICION DEL COMANDO DE BORRADO\r\n## Usamos comillas escapadas para que el scheduler guarde el nombre fijo del usuario.\r\n:local evento \"/ip hotspot active remove [find user=\\\"$usuario\\\"]; /ip hotspot user remove [find name=\\\"$usuario\\\"]; /system scheduler remove [find name=\\\"$usuario\\\"]\"\r\n\r\n## 4. CREACION INTELIGENTE DE LA TAREA\r\n:do {\r\n    ## INTENTO 1: Crear normal (Fecha de hoy + Hora calculada)\r\n    ## Si son las 23:55 y sumas 2h, esto fallar\u00e1 porque la fecha no coincide.\r\n    /system scheduler add name=\"$usuario\" start-date=$fechaActual start-time=$horaFin interval=0s on-event=$evento\r\n    /log info \"\u2705 [Normal] Tarea creada para $usuario. Expira a las $horaFin\"\r\n\r\n} on-error={\r\n    ## INTENTO 2 (RESPALDO AUTOMATICO):\r\n    ## Si fall\u00f3 lo anterior, es porque cambiamos de d\u00eda (pasada la medianoche).\r\n    ## Al poner SOLO start-time sin start-date, RouterOS es inteligente y\r\n    ## asigna automaticamente la fecha de 'next day'.\r\n    /system scheduler add name=\"$usuario\" start-time=$horaFin interval=0s on-event=$evento\r\n    /log warning \"\ud83c\udf19 [Medianoche] Tarea agendada para next day a las $horaFin (usuario: $usuario)\"\r\n}"
    },
    "1_mes": {
        "nombre_visible": "1_Mes",
        "script_on_login": "##  SCRIPT FINAL: ELIMINACION DE TICKET (A PRUEBA DE MEDIANOCHE)\r\n:local usuario \"$user\"\r\n:local duracion \"30d00:00:00\"\r\n\r\n## 1. LIMPIEZA TOTAL\r\n## Primero borramos si ya existe algo con ese nombre para evitar duplicados o errores.\r\n:do {\r\n    /system scheduler remove [find name=\"$usuario\"]\r\n} on-error={}\r\n\r\n## 2. CALCULO DE TIEMPO\r\n:local horaActual [/system clock get time]\r\n:local fechaActual [/system clock get date]\r\n:local horaFin ($horaActual + [:totime $duracion])\r\n\r\n## 3. DEFINICION DEL COMANDO DE BORRADO\r\n## Usamos comillas escapadas para que el scheduler guarde el nombre fijo del usuario.\r\n:local evento \"/ip hotspot active remove [find user=\\\"$usuario\\\"]; /ip hotspot user remove [find name=\\\"$usuario\\\"]; /system scheduler remove [find name=\\\"$usuario\\\"]\"\r\n\r\n## 4. CREACION INTELIGENTE DE LA TAREA\r\n:do {\r\n    ## INTENTO 1: Crear normal (Fecha de hoy + Hora calculada)\r\n    ## Si son las 23:55 y sumas 2h, esto fallar\u00e1 porque la fecha no coincide.\r\n    /system scheduler add name=\"$usuario\" start-date=$fechaActual start-time=$horaFin interval=0s on-event=$evento\r\n    /log info \"\u2705 [Normal] Tarea creada para $usuario. Expira a las $horaFin\"\r\n\r\n} on-error={\r\n    ## INTENTO 2 (RESPALDO AUTOMATICO):\r\n    ## Si fall\u00f3 lo anterior, es porque cambiamos de d\u00eda (pasada la medianoche).\r\n    ## Al poner SOLO start-time sin start-date, RouterOS es inteligente y\r\n    ## asigna automaticamente la fecha de 'next day'.\r\n    /system scheduler add name=\"$usuario\" start-time=$horaFin interval=0s on-event=$evento\r\n    /log warning \"\ud83c\udf19 [Medianoche] Tarea agendada para next day a las $horaFin (usuario: $usuario)\"\r\n}"
    },
    "1_semana": {
        "nombre_visible": "1_Semana",
        "script_on_login": ":local usuario \"$user\"\r\n:local duracion \"3d12:00:00\"\r\n\r\n## 1. VERIFICACI\u00d3N\r\n:local tareaExiste [:len [/system scheduler find name=\"$usuario\"]]\r\n\r\n:if ($tareaExiste = 0) do={\r\n    /log info \"Creando tarea de expiracion para $usuario duracion $duracion\"\r\n    \r\n    ## 2. LOGICA DE CREACI\u00d3N\r\n    ## Convertimos duracion a tiempo para comparar\r\n    :local duracionTime [:totime $duracion]\r\n\r\n    ## CASO A: SI ES MENOS DE 24 HORAS (Tu metodo original funciona bien aqui)\r\n    :if ($duracionTime < 1d) do={\r\n        :local horaActual [/system clock get time]\r\n        :local fechaActual [/system clock get date]\r\n        :local horaFin ($horaActual + $duracionTime)\r\n        :local evento \"/ip hotspot active remove [find user=\\\"$usuario\\\"]; /ip hotspot user remove [find name=\\\"$usuario\\\"]; /system scheduler remove [find name=\\\"$usuario\\\"]\"\r\n        \r\n        ## Si horaFin se pasa de 24h (ej. 23:00 + 2h = 01:00 del dia siguiente), RouterOS lo maneja mal en start-time directo\r\n        ## Por seguridad usamos interval para todo o el on-error\r\n        :do {\r\n             /system scheduler add name=\"$usuario\" start-date=$fechaActual start-time=$horaFin interval=0s on-event=$evento\r\n        } on-error={\r\n             ## Fallback si cambia de dia (simple)\r\n             /system scheduler add name=\"$usuario\" interval=$duracionTime on-event=$evento\r\n        }\r\n    } else={\r\n        ## CASO B: SI SON DIAS (7d, 30d, etc)\r\n        ## Usamos el \"Truco del Intervalo\" con doble paso para evitar el calculo de fechas\r\n        \r\n        ## El evento se modifica: Primero revisa si ya paso el tiempo, si no, marca una bandera.\r\n        ## Esto evita tener que calcular la fecha exacta \"Jun/04/2025\".\r\n        :local eventoDias \"\r\n           :local self [find name=\\\"$usuario\\\"];\r\n           :if ([get \\$self comment] = \\\"FINAL\\\") do={\r\n               /ip hotspot active remove [find user=\\\"$usuario\\\"];\r\n               /ip hotspot user remove [find name=\\\"$usuario\\\"];\r\n               /system scheduler remove \\$self;\r\n           } else={\r\n               /system scheduler set \\$self comment=\\\"FINAL\\\";\r\n           }\r\n        \"\r\n        \r\n        ## Creamos el scheduler:\r\n        ## 1. start-time=startup: Se ejecuta apenas se crea.\r\n        ## 2. interval=$duracion: Espera los 7 dias para la segunda ejecucion.\r\n        ## 3. comment=INICIO: La primera vez no borra nada, solo cambia el comentario a FINAL.\r\n        /system scheduler add name=\"$usuario\" start-time=startup interval=$duracionTime on-event=$eventoDias comment=\"INICIO\"\r\n        /log info \"Tarea de dias creada. El usuario se eliminara en $duracion\"\r\n    }\r\n\r\n} else={\r\n    /log info \"La tarea para $usuario ya existe. No se renueva.\"\r\n}"
    },
    "30_dias": {
        "nombre_visible": "30_Dias",
        "script_on_login": ":local usuario \"$user\"\r\n:local duracion \"15d12:00:00\"\r\n\r\n## 1. VERIFICACI\u00d3N\r\n:local tareaExiste [:len [/system scheduler find name=\"$usuario\"]]\r\n\r\n:if ($tareaExiste = 0) do={\r\n    /log info \"Creando tarea de expiracion para $usuario duracion $duracion\"\r\n    \r\n    ## 2. LOGICA DE CREACI\u00d3N\r\n    ## Convertimos duracion a tiempo para comparar\r\n    :local duracionTime [:totime $duracion]\r\n\r\n    ## CASO A: SI ES MENOS DE 24 HORAS (Tu metodo original funciona bien aqui)\r\n    :if ($duracionTime < 1d) do={\r\n        :local horaActual [/system clock get time]\r\n        :local fechaActual [/system clock get date]\r\n        :local horaFin ($horaActual + $duracionTime)\r\n        :local evento \"/ip hotspot active remove [find user=\\\"$usuario\\\"]; /ip hotspot user remove [find name=\\\"$usuario\\\"]; /system scheduler remove [find name=\\\"$usuario\\\"]\"\r\n        \r\n        ## Si horaFin se pasa de 24h (ej. 23:00 + 2h = 01:00 del dia siguiente), RouterOS lo maneja mal en start-time directo\r\n        ## Por seguridad usamos interval para todo o el on-error\r\n        :do {\r\n             /system scheduler add name=\"$usuario\" start-date=$fechaActual start-time=$horaFin interval=0s on-event=$evento\r\n        } on-error={\r\n             ## Fallback si cambia de dia (simple)\r\n             /system scheduler add name=\"$usuario\" interval=$duracionTime on-event=$evento\r\n        }\r\n    } else={\r\n        ## CASO B: SI SON DIAS (7d, 30d, etc)\r\n        ## Usamos el \"Truco del Intervalo\" con doble paso para evitar el calculo de fechas\r\n        \r\n        ## El evento se modifica: Primero revisa si ya paso el tiempo, si no, marca una bandera.\r\n        ## Esto evita tener que calcular la fecha exacta \"Jun/04/2025\".\r\n        :local eventoDias \"\r\n           :local self [find name=\\\"$usuario\\\"];\r\n           :if ([get \\$self comment] = \\\"FINAL\\\") do={\r\n               /ip hotspot active remove [find user=\\\"$usuario\\\"];\r\n               /ip hotspot user remove [find name=\\\"$usuario\\\"];\r\n               /system scheduler remove \\$self;\r\n           } else={\r\n               /system scheduler set \\$self comment=\\\"FINAL\\\";\r\n           }\r\n        \"\r\n        \r\n        ## Creamos el scheduler:\r\n        ## 1. start-time=startup: Se ejecuta apenas se crea.\r\n        ## 2. interval=$duracion: Espera los 7 dias para la segunda ejecucion.\r\n        ## 3. comment=INICIO: La primera vez no borra nada, solo cambia el comentario a FINAL.\r\n        /system scheduler add name=\"$usuario\" start-time=startup interval=$duracionTime on-event=$eventoDias comment=\"INICIO\"\r\n        /log info \"Tarea de dias creada. El usuario se eliminara en $duracion\"\r\n    }\r\n\r\n} else={\r\n    /log info \"La tarea para $usuario ya existe. No se renueva.\"\r\n}"
    }
}